local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local camera = workspace.CurrentCamera

-- GUIs
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MenuBallGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Ball (round floating button)
local ball = Instance.new("ImageButton")
ball.Name = "MagicBall"
ball.Size = UDim2.new(0, 70, 0, 70)
ball.Position = UDim2.new(0.1, 0, 0.1, 0)
ball.BackgroundTransparency = 1
ball.Image = "rbxassetid://3570695787" -- circular base
ball.ImageColor3 = Color3.fromRGB(170, 0, 255)
ball.ScaleType = Enum.ScaleType.Stretch
ball.AutoButtonColor = false
ball.Parent = screenGui
ball.Draggable = true

-- Emoji inside ball
local emoji = Instance.new("TextLabel")
emoji.Size = UDim2.new(1, 0, 1, 0)
emoji.BackgroundTransparency = 1
emoji.Text = "üëæ"
emoji.TextScaled = true
emoji.Font = Enum.Font.FredokaOne
emoji.TextColor3 = Color3.new(1, 1, 1)
emoji.Parent = ball

-- Menu container
local menu = Instance.new("Frame")
menu.Size = UDim2.new(0, 300, 0, 400)
menu.Position = UDim2.new(0, 100, 0, 100)
menu.BackgroundColor3 = Color3.fromRGB(40, 0, 60)
menu.Visible = false
menu.Active = true
menu.Draggable = true
menu.BorderSizePixel = 0
menu.Parent = screenGui

-- Button creation function
local function createButton(text, icon)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -20, 0, 40)
	btn.Position = UDim2.new(0, 10, 0, 0)
	btn.BackgroundColor3 = Color3.fromRGB(100, 0, 180)
	btn.Text = icon .. "  " .. text
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.FredokaOne
	btn.TextScaled = true
	btn.AutoButtonColor = false
	btn.ClipsDescendants = true

	local defaultColor = btn.BackgroundColor3
	local hoverColor = Color3.fromRGB(150, 0, 220)

	btn.MouseEnter:Connect(function()
		TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor}):Play()
	end)

	btn.MouseLeave:Connect(function()
		TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = defaultColor}):Play()
	end)

	btn.Parent = menu
	return btn
end

-- Save preferences
local function saveAttr(name, value)
	player:SetAttribute(name, value)
end

-- States
local isUp = false
local teleportPos = nil
local espOn = player:GetAttribute("ESP") or false
local godMode = player:GetAttribute("GodMode") or false
local infiniteJump = player:GetAttribute("InfJump") or false

-- Buttons
local upButton = createButton("Fly (15s)", "‚òÅÔ∏è")
local speedButton = createButton("Speed 60", "‚ö°")
local jumpButton = createButton("High Jump", "ü¶ò")
local espButton = createButton("ESP", "üëÅÔ∏è")
local teleportButton = createButton("Teleport", "üìç")
local godButton = createButton("God Mode", "üõ°Ô∏è")
local jumpInfButton = createButton("Infinite Jump", "üîÅ")

-- Position buttons
local function layoutButtons()
	local y = 0
	for _, child in ipairs(menu:GetChildren()) do
		if child:IsA("TextButton") then
			child.Position = UDim2.new(0, 10, 0, y)
			y += 45
		end
	end
end
layoutButtons()

-- Button Logic

-- Fly up
upButton.MouseButton1Click:Connect(function()
	if isUp then return end
	isUp = true
	local root = character:FindFirstChild("HumanoidRootPart")
	if root then
		root.Anchored = true
		root.CFrame = CFrame.new(root.Position.X, 196.2, root.Position.Z)
		task.wait(15)
		root.Anchored = false
	end
	isUp = false
end)

-- Speed
speedButton.MouseButton1Click:Connect(function()
	humanoid.WalkSpeed = 60
end)

-- Jump Boost
jumpButton.MouseButton1Click:Connect(function()
	humanoid.UseJumpPower = true
	humanoid.JumpPower = 120
	humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
end)

-- ESP
espButton.MouseButton1Click:Connect(function()
	espOn = not espOn
	saveAttr("ESP", espOn)
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local hrp = plr.Character.HumanoidRootPart
			if espOn then
				if not hrp:FindFirstChild("ESPBox") then
					local box = Instance.new("BoxHandleAdornment")
					box.Name = "ESPBox"
					box.Adornee = hrp
					box.Size = Vector3.new(3,6,3)
					box.AlwaysOnTop = true
					box.ZIndex = 10
					box.Color3 = Color3.fromRGB(255, 0, 255)
					box.Transparency = 0.5
					box.Parent = hrp
				end
			else
				local box = hrp:FindFirstChild("ESPBox")
				if box then box:Destroy() end
			end
		end
	end
end)

-- Teleport System
teleportButton.MouseButton1Click:Connect(function()
	local root = character:FindFirstChild("HumanoidRootPart")
	if not root then return end
	if not teleportPos then
		teleportPos = root.Position
		teleportButton.Text = "üìç Set!"
	else
		root.CFrame = CFrame.new(teleportPos)
		teleportButton.Text = "üìç Teleport"
		teleportPos = nil
	end
end)

-- God Mode
godButton.MouseButton1Click:Connect(function()
	godMode = not godMode
	saveAttr("GodMode", godMode)

	if godMode then
		humanoid:GetPropertyChangedSignal("Health"):Connect(function()
			if godMode and humanoid.Health < humanoid.MaxHealth then
				humanoid.Health = humanoid.MaxHealth
			end
		end)
	end
end)

character.DescendantAdded:Connect(function(obj)
	if godMode and (obj:IsA("BallSocketConstraint") or obj.Name:lower():find("ragdoll")) then
		obj:Destroy()
	end
end)

-- Infinite Jump
jumpInfButton.MouseButton1Click:Connect(function()
	infiniteJump = not infiniteJump
	saveAttr("InfJump", infiniteJump)
end)

UserInputService.JumpRequest:Connect(function()
	if infiniteJump then
		humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
	end
end)

-- Toggle Menu
local menuVisible = false
ball.MouseButton1Click:Connect(function()
	menuVisible = not menuVisible
	menu.Visible = menuVisible
end)
